<!doctype html><html lang=en><head><title>Shared Scripts on Windows and Linux</title><meta charset=utf-8><meta name=generator content="Hugo 0.112.7"><meta name=author content="Florian Winkelbauer"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://florianwinkelbauer.com/posts/2020-08-09-portable-scripts/><link rel=alternate type=application/rss+xml title=RSS href=https://florianwinkelbauer.com/index.xml><link rel=stylesheet href=https://florianwinkelbauer.com/main.css></head><body><header class=dark><h2><a href=https://florianwinkelbauer.com/>Florian Winkelbauer</a></h2><nav><a href=/about>About</a>
<a href=/projects>Projects</a></nav></header><main><article><header><h1><a href=https://florianwinkelbauer.com/posts/2020-08-09-portable-scripts/>Shared Scripts on Windows and Linux</a></h1><time datetime=2020-08-09T00:00:00Z>August 09, 2020</time></header><p>Sometimes you end up in a situation where you would like to use the same script
on different operating systems (e.g. Linux and Windows). Now you have to choose
between two possibilities:</p><ul><li>Write the same script in different languages (e.g. Bash and PowerShell)</li><li>Write your script in one language and ensure that you can use it on all
systems (e.g. by using PowerShell Core)</li></ul><p>I&rsquo;ve recently experimented with the second approach. But which portable language
should one use? Well, I went down the crazy road and opened up my good old
friend Emacs. Let&rsquo;s start with two Bash examples:</p><p>A script to run <code>git pull</code> in several directories:</p><pre><code class=language-shell>set -euo pipefail

repositories=(~/.emacs.d/ ~/Projects/*/)

for repo in ${repositories[*]}
do
    echo &quot;Pulling '$repo'&quot;
    pushd &quot;$repo&quot; &gt; /dev/null
    git pull
    popd &gt; /dev/null
done
</code></pre><p>And a simple <code>rsync</code> backup script:</p><pre><code class=language-shell>set -euo pipefail

dest=/some/backup/location

rsync=&quot;rsync -avh --delete&quot;

$rsync ~/Documents &quot;$dest&quot;
$rsync ~/Projects &quot;$dest&quot;
</code></pre><p>Now let&rsquo;s rewrite these scripts in Lisp. Here&rsquo;s the <code>git</code> script (which relies
on the <code>magit</code> package):</p><pre><code class=language-emacs-lisp>(defun fw/git-pull-all ()
  &quot;Runs git pull for every repository found in `magit-list-repos'&quot;
  (interactive)
  (require 'magit)
  (if magit-repository-directories
      (dolist (path (magit-list-repos))
        (let ((default-directory path))
          (let ((exit-code (fw/exec-app &quot;git&quot; (list &quot;pull&quot; path))))
            (unless (eq exit-code 0)
              (user-error &quot;Error while pulling \&quot;%s\&quot;&quot; path)))))))
</code></pre><p>And the <code>rsync</code> script:</p><pre><code class=language-emacs-lisp>(defun fw/rsync (&amp;rest args)
  &quot;Calls the rsync binary&quot;
  (fw/exec-app-validated &quot;rsync&quot; args '(0)))

(defun fw/rsync-backup ()
  &quot;Creates my rsync backup&quot;
  (interactive)
  (let ((destination &quot;/some/backup/location&quot;)
        (directories '(&quot;~/Documents&quot;
                       &quot;~/Projects&quot;)))
    (dolist (directory directories)
      (fw/rsync &quot;-avh --delete&quot; directory destination))))
</code></pre><p>The above snippets rely on these helper functions:</p><pre><code class=language-emacs-lisp>(defun fw/exec-app (application args)
  &quot;Runs an `application' with a list of `args' using
`shell-command' and returns the exit code&quot;
  (let ((shell-command-dont-erase-buffer t)
        (full-cmd (string-join (add-to-list 'args application) &quot; &quot;)))
    (shell-command full-cmd (concat &quot;*exec &quot; application &quot;*&quot;))))

(defun fw/exec-app-validated (application args valid-exit-codes)
  &quot;Runs an `application' with a list of `args' using
`shell-command' and throws a `user-error' if the exit code is not
a member of the `valid-exit-codes' list&quot;
  (let ((exit-code (fw/exec-app application args)))
    (unless (member exit-code valid-exit-codes)
      (user-error &quot;Exit code of \&quot;%s\&quot; was %s&quot; application exit-code))))
</code></pre><p>It was fun to come up with the above solutions, but for the most part I&rsquo;ll
rewrite my scripts depending on which operating system I&rsquo;m on. While Emacs has
become a big part of my daily Computer work, I&rsquo;m still not convinced that this
tool should be utilized everywhere.</p></article></main><footer><p>Copyright 2023, Florian Winkelbauer. All rights reserved.</p></footer></body></html>